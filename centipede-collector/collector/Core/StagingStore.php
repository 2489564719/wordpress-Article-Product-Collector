<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-25 08:49:33              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_StagingStore { public const CPT = 'sbb_collect_staging'; public const META_KEY = '_sbb_staging_data'; public static function init() : void { add_action('init', [self::class, 'register']); } public static function register() : void { register_post_type(self::CPT, ['labels' => ['name' => '采集暂存', 'singular_name' => '采集暂存'], 'public' => false, 'show_ui' => false, 'supports' => ['title']]); } public static function create(string $fhD7r, array $eDwhV) : int { goto msgds; IA2bR: update_post_meta($sSmgE, self::META_KEY, $eDwhV); goto qnu2e; c0dpK: if (!isset($eDwhV['content_type'])) { $eDwhV['content_type'] = SBB_Collector_ConfigStore::get_mode(); } goto IA2bR; qnu2e: if (isset($eDwhV['source_url'])) { update_post_meta($sSmgE, '_sbb_source_url', esc_url_raw($eDwhV['source_url'])); } goto KQmEy; IKGSf: if (is_wp_error($sSmgE)) { error_log('Collector: Failed to create staging post. Error: ' . $sSmgE->get_error_message()); return 0; } goto c0dpK; msgds: $sSmgE = wp_insert_post(['post_type' => self::CPT, 'post_status' => 'draft', 'post_title' => $fhD7r], true); goto IKGSf; KQmEy: return (int) $sSmgE; goto AgBLq; AgBLq: } public static function update_data(int $JVE8g, array $viIk_) : void { goto eLlNC; boNP9: update_post_meta($JVE8g, self::META_KEY, $HCBI6); goto mnbiy; eLlNC: $cov5l = get_post_meta($JVE8g, self::META_KEY, true); goto Hsvnz; Hsvnz: if (!is_array($cov5l)) { $cov5l = []; } goto zthLb; zthLb: $HCBI6 = array_merge($cov5l, $viIk_); goto boNP9; mnbiy: } public static function count_stati() : int { goto BaMgm; vzmXS: return $GBGh3; goto UIaPP; DArvS: foreach ($Ej5VU->posts as $sSmgE) { goto frRWs; U3s7s: $GBGh3++; goto FTrQf; pjO3G: if ($CZbzy !== $Jq_LY && !($CZbzy === 'product' && empty($f1n67['content_type']))) { continue; } goto U3s7s; l9iDT: if (!is_array($f1n67)) { $f1n67 = []; } goto nQ4Rl; frRWs: $f1n67 = get_post_meta($sSmgE, self::META_KEY, true); goto l9iDT; nQ4Rl: $Jq_LY = $f1n67['content_type'] ?? 'product'; goto pjO3G; FTrQf: } goto vzmXS; cgIQO: $Ej5VU = new WP_Query(['post_type' => self::CPT, 'post_status' => 'any', 'posts_per_page' => -1, 'orderby' => 'date', 'order' => 'DESC', 'fields' => 'ids']); goto aDIMM; BaMgm: $CZbzy = SBB_Collector_ConfigStore::get_mode(); goto cgIQO; aDIMM: $GBGh3 = 0; goto DArvS; UIaPP: } public static function get_stati(int $LMgT0, int $tDLbK) : array { goto QVizj; zZUYJ: $MoYIn = []; goto PWFiz; M2nnC: $Ej5VU = new WP_Query(['post_type' => self::CPT, 'post_status' => 'any', 'posts_per_page' => -1, 'orderby' => 'date', 'order' => 'DESC']); goto zZUYJ; MTt4F: $JTl2X = array_slice($MoYIn, max(0, $tDLbK), $LMgT0); goto V3sOW; PWFiz: foreach ($Ej5VU->posts as $eEbXO) { goto DXUBD; U3_qR: if ($Q5qfZ) { $L2Te2 = '<span style="color:purple;">已发布</span>'; } else { $L2Te2 = $BfZgh === 'processed' ? '<span style="color:green;">已处理</span>' : '<span style="color:orange;">待处理</span>'; } goto fFPta; gR2bM: $KgPcJ = get_post_meta($eEbXO->ID, '_sbb_published_post_id', true); goto sEMwj; MaftQ: $FpDzi = get_post_meta($eEbXO->ID, '_sbb_published_product_id', true); goto gR2bM; Nj2Pu: $Jq_LY = $f1n67['content_type'] ?? 'product'; goto vvcPR; fFPta: $MoYIn[] = ['ID' => $eEbXO->ID, 'title' => $eEbXO->post_title, 'source_url' => $f1n67['source_url'] ?? '', 'attachments' => count(get_children(['post_parent' => $eEbXO->ID, 'post_type' => 'attachment', 'fields' => 'ids'])), 'status' => $L2Te2, 'date' => get_the_date('Y-m-d H:i', $eEbXO), 'content_type' => $Jq_LY, 'published_product_id' => $FpDzi, 'published_post_id' => $KgPcJ]; goto rrhxT; Kx07e: if (!is_array($f1n67)) { $f1n67 = []; } goto Nj2Pu; uErXU: $BfZgh = $f1n67['status'] ?? 'pending'; goto MaftQ; vvcPR: if ($CZbzy !== $Jq_LY && !($CZbzy === 'product' && empty($f1n67['content_type']))) { continue; } goto uErXU; DXUBD: $f1n67 = get_post_meta($eEbXO->ID, self::META_KEY, true); goto Kx07e; sEMwj: $Q5qfZ = $Jq_LY === 'post' ? !empty($KgPcJ) : !empty($FpDzi); goto U3_qR; rrhxT: } goto MTt4F; V3sOW: return $JTl2X; goto RpbFB; QVizj: $CZbzy = SBB_Collector_ConfigStore::get_mode(); goto M2nnC; RpbFB: } public static function is_source_url_exists(string $mSu7S) : bool { $Ej5VU = new WP_Query(['post_type' => self::CPT, 'meta_key' => '_sbb_source_url', 'meta_value' => esc_url_raw($mSu7S), 'posts_per_page' => 1, 'fields' => 'ids']); return $Ej5VU->have_posts(); } }
