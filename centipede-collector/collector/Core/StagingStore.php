<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-22 08:59:56              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_StagingStore { public const CPT = 'sbb_collect_staging'; public const META_KEY = '_sbb_staging_data'; public static function init() : void { add_action('init', [self::class, 'register']); } public static function register() : void { register_post_type(self::CPT, ['labels' => ['name' => '采集暂存', 'singular_name' => '采集暂存'], 'public' => false, 'show_ui' => false, 'supports' => ['title']]); } public static function create(string $nvkTo, array $KbMVY) : int { goto XWWfT; cxiNG: update_post_meta($VGZh2, self::META_KEY, $KbMVY); goto X8XJ2; VHo5q: return (int) $VGZh2; goto QFVHV; coQgt: if (is_wp_error($VGZh2)) { error_log('Collector: Failed to create staging post. Error: ' . $VGZh2->get_error_message()); return 0; } goto NsNDK; NsNDK: if (!isset($KbMVY['content_type'])) { $KbMVY['content_type'] = SBB_Collector_ConfigStore::get_mode(); } goto cxiNG; XWWfT: $VGZh2 = wp_insert_post(['post_type' => self::CPT, 'post_status' => 'draft', 'post_title' => $nvkTo], true); goto coQgt; X8XJ2: if (isset($KbMVY['source_url'])) { update_post_meta($VGZh2, '_sbb_source_url', esc_url_raw($KbMVY['source_url'])); } goto VHo5q; QFVHV: } public static function update_data(int $oeoE7, array $MUtOY) : void { goto DP_MJ; DP_MJ: $d5koT = get_post_meta($oeoE7, self::META_KEY, true); goto DWzw0; DWzw0: if (!is_array($d5koT)) { $d5koT = []; } goto FlAle; qHLUd: update_post_meta($oeoE7, self::META_KEY, $jXrdr); goto bkS5z; FlAle: $jXrdr = array_merge($d5koT, $MUtOY); goto qHLUd; bkS5z: } public static function count_stati() : int { $PyVd6 = wp_count_posts(self::CPT); return (int) ($PyVd6->draft ?? 0); } public static function get_stati(int $GQPI7, int $UwTSa) : array { goto YaoX2; Qe0Xy: return $sY0sO; goto e1FhJ; YaoX2: $ywL2F = new WP_Query(['post_type' => self::CPT, 'posts_per_page' => $GQPI7, 'offset' => $UwTSa, 'orderby' => 'date', 'order' => 'DESC']); goto iBWrS; Rlzrl: foreach ($ywL2F->posts as $V1j6k) { goto SVEzW; xLyTh: $ZvWtU = get_post_meta($V1j6k->ID, '_sbb_published_product_id', true); goto M6rS3; Q1p3G: $LQhyG = $Elm06['status'] ?? 'pending'; goto xLyTh; VMfHV: $PhYkQ = $Elm06['content_type'] ?? 'product'; goto ME1YU; SVEzW: $Elm06 = get_post_meta($V1j6k->ID, self::META_KEY, true); goto DA4Rj; dGPMg: $sY0sO[] = ['ID' => $V1j6k->ID, 'title' => $V1j6k->post_title, 'source_url' => $Elm06['source_url'] ?? '', 'attachments' => count(get_children(['post_parent' => $V1j6k->ID, 'post_type' => 'attachment', 'fields' => 'ids'])), 'status' => $KaJxL, 'date' => get_the_date('Y-m-d H:i', $V1j6k), 'content_type' => $PhYkQ, 'published_product_id' => $ZvWtU, 'published_post_id' => $Fk9e3]; goto DOAj7; dhib5: $aUA5e = $PhYkQ === 'post' ? !empty($Fk9e3) : !empty($ZvWtU); goto K50Di; K50Di: if ($aUA5e) { $KaJxL = '<span style="color:purple;">已发布</span>'; } else { $KaJxL = $LQhyG === 'processed' ? '<span style="color:green;">已处理</span>' : '<span style="color:orange;">待处理</span>'; } goto dGPMg; M6rS3: $Fk9e3 = get_post_meta($V1j6k->ID, '_sbb_published_post_id', true); goto dhib5; DA4Rj: if (!is_array($Elm06)) { $Elm06 = []; } goto VMfHV; ME1YU: if ($yBcXZ !== $PhYkQ && !($yBcXZ === 'product' && empty($Elm06['content_type']))) { continue; } goto Q1p3G; DOAj7: } goto Qe0Xy; Mn9tj: $sY0sO = []; goto Rlzrl; iBWrS: $yBcXZ = SBB_Collector_ConfigStore::get_mode(); goto Mn9tj; e1FhJ: } public static function is_source_url_exists(string $kC2lc) : bool { $ywL2F = new WP_Query(['post_type' => self::CPT, 'meta_key' => '_sbb_source_url', 'meta_value' => esc_url_raw($kC2lc), 'posts_per_page' => 1, 'fields' => 'ids']); return $ywL2F->have_posts(); } }
