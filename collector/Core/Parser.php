<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-22 08:59:56              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_Parser { public static function css_to_xpath(string $A4Mu9) : string { goto deovA; VFEzs: if ($A4Mu9 === '') { return ''; } goto DoCAj; deovA: $A4Mu9 = trim($A4Mu9); goto VFEzs; DoCAj: $dZ9va = preg_split('/\\s+/', $A4Mu9); goto h5_Zp; h5_Zp: $avtoX = []; goto GrlFF; GrlFF: foreach ($dZ9va as $ZEQ2h) { if (preg_match('/^#([A-Za-z0-9_-]+)$/', $ZEQ2h, $BDjq4)) { $avtoX[] = "*[@id='{$BDjq4[1]}']"; } elseif (preg_match('/^\\.([A-Za-z0-9_-]+)$/', $ZEQ2h, $BDjq4)) { $avtoX[] = "*[contains(concat(' ', normalize-space(@class), ' '), ' {$BDjq4[1]} ')]"; } elseif (preg_match('/^[A-Za-z0-9_-]+$/', $ZEQ2h)) { $avtoX[] = $ZEQ2h; } elseif (preg_match('/^([A-Za-z0-9_-]+)?\\[(.+)\\]$/', $ZEQ2h, $BDjq4)) { goto bg0Ok; bg0Ok: $d4RkF = $BDjq4[1] !== '' ? $BDjq4[1] : '*'; goto xyHES; IGImA: if (preg_match('/^([A-Za-z0-9_-]+)\\s*=\\s*["\']?([^"\']+)["\']?$/', $pBgsG, $gPD0V)) { goto UrLIA; VmRAj: $avtoX[] = sprintf('%s[@%s=%s]', $d4RkF, $z481L, self::xpath_literal($CJEAM)); goto WJy2G; LJ6kY: $CJEAM = $gPD0V[2]; goto VmRAj; UrLIA: $z481L = $gPD0V[1]; goto LJ6kY; WJy2G: } elseif (preg_match('/^([A-Za-z0-9_-]+)$/', $pBgsG, $jt3n8)) { $z481L = $jt3n8[1]; $avtoX[] = sprintf('%s[@%s]', $d4RkF, $z481L); } else { return ''; } goto F8bNf; xyHES: $pBgsG = trim($BDjq4[2]); goto IGImA; F8bNf: } else { return ''; } } goto UQD3Q; UQD3Q: return '//' . implode('//', $avtoX); goto MvQxX; MvQxX: } private static function xpath_literal(string $pWWEe) : string { goto C2Fw3; wxl32: return 'concat(' . implode(',', $Zp6gk) . ')'; goto YuI4h; qv4B5: foreach ($dZ9va as $KJwU8 => $LARHS) { if ($KJwU8 > 0) { $Zp6gk[] = "'"; } if ($LARHS !== '') { $Zp6gk[] = "'" . $LARHS . "'"; } } goto wxl32; zR8mk: if (strpos($pWWEe, '"') === false) { return '"' . $pWWEe . '"'; } goto yhHP0; C2Fw3: if (strpos($pWWEe, "'") === false) { return "'" . $pWWEe . "'"; } goto zR8mk; OHm7i: $Zp6gk = []; goto qv4B5; yhHP0: $dZ9va = explode("'", $pWWEe); goto OHm7i; YuI4h: } public static function extract(string $cbr0c, string $A4Mu9, string $S0ajy, string $Rfeqy, SBB_Collector_Logger $l_bxf) : array { goto yKIFu; t43LT: $mLEpW = new DOMXPath($sd5DK); goto vcE_L; yKIFu: libxml_use_internal_errors(true); goto Fzgfk; vcE_L: $AxdsG = self::css_to_xpath($A4Mu9); goto E3_Lz; AHmFU: $l_bxf->info('Selector matched', ['count' => $NjcBX, 'selector' => $A4Mu9, 'xpath' => $AxdsG]); goto xBM1m; hrVv3: if (!$aKyAI || $NjcBX === 0) { return $AtZ0M; } goto NQuv7; NQuv7: if ($S0ajy === 'image' || $S0ajy === 'images') { goto urYYz; urYYz: $M9xdH = $S0ajy === 'image' ? 1 : -1; goto oKlDz; TPRJp: foreach ($aKyAI as $Cquas) { goto lzRHs; v6erJ: $CcNRW = $Cquas->getElementsByTagName('img'); goto h04Gu; lzRHs: if (strtolower($Cquas->nodeName) === 'img') { goto mslZa; as8uS: $fWXLU = $Cquas->getAttribute('src'); goto lXzD6; mslZa: if ($M9xdH !== -1 && $PyVd6 >= $M9xdH) { break; } goto as8uS; lXzD6: if ($fWXLU) { $AtZ0M[] = ['kind' => 'image_url', 'content' => $fWXLU]; $PyVd6++; } goto p508H; p508H: continue; goto tvAOH; tvAOH: } goto v6erJ; h04Gu: foreach ($CcNRW as $qwliE) { goto waLiu; RXpAg: if ($fWXLU) { $AtZ0M[] = ['kind' => 'image_url', 'content' => $fWXLU]; $PyVd6++; } goto PBGhT; Eyf0X: $fWXLU = $qwliE->getAttribute('src'); goto RXpAg; waLiu: if ($M9xdH !== -1 && $PyVd6 >= $M9xdH) { break; } goto Eyf0X; PBGhT: } goto IDUhh; IDUhh: } goto JkvuT; JkvuT: return $AtZ0M; goto EnNSa; oKlDz: $PyVd6 = 0; goto TPRJp; EnNSa: } goto iaF5X; Fzgfk: $sd5DK = new DOMDocument(); goto KqUx8; xBM1m: $AtZ0M = []; goto hrVv3; UKZ9o: $aKyAI = $mLEpW->query($AxdsG); goto CU7Dg; E3_Lz: if (!$AxdsG) { $l_bxf->warn('无效或空的 CSS 选择器，跳过提取。', ['selector' => $A4Mu9]); return []; } goto UKZ9o; KqUx8: $sd5DK->loadHTML('<?xml encoding="utf-8" ?>' . $cbr0c); goto Z0sXH; Z0sXH: $RXRRG = libxml_get_errors(); goto mXIee; FldNZ: return $AtZ0M; goto wvbqA; y1WAC: libxml_clear_errors(); goto t43LT; CU7Dg: $NjcBX = $aKyAI ? $aKyAI->length : 0; goto AHmFU; mXIee: if (!empty($RXRRG)) { $l_bxf->warn('HTML parsing produced errors in Parser::extract.', ['errors' => wp_json_encode($RXRRG)]); } goto y1WAC; iaF5X: foreach ($aKyAI as $Cquas) { if ($S0ajy === 'text') { $AtZ0M[] = ['kind' => 'text', 'content' => $Cquas->textContent]; } elseif ($S0ajy === 'attr' && $Rfeqy !== '') { $AtZ0M[] = ['kind' => 'attr', 'content' => $Cquas->getAttribute($Rfeqy)]; } else { $AtZ0M[] = ['kind' => 'html', 'content' => $sd5DK->saveHTML($Cquas)]; } } goto FldNZ; wvbqA: } public static function extract_title(string $cbr0c) : string { goto LEcWh; c4zvu: libxml_clear_errors(); goto xv8dx; aPU3h: $sd5DK->loadHTML('<?xml encoding="utf-8" ?>' . $cbr0c); goto c4zvu; nkys1: $sd5DK = new DOMDocument(); goto aPU3h; xv8dx: $UE8BX = $sd5DK->getElementsByTagName('title'); goto hn1Bl; LEcWh: libxml_use_internal_errors(true); goto nkys1; hn1Bl: if ($UE8BX && $UE8BX->length > 0) { $Zoi0B = trim($UE8BX->item(0)->textContent); if ($Zoi0B !== '') { return $Zoi0B; } } goto ftHaX; x9fej: return ''; goto HIkbS; ftHaX: if (preg_match('/<title[^>]*>(.*?)<\\/title>/is', $cbr0c, $BDjq4)) { return trim(html_entity_decode(strip_tags($BDjq4[1]), ENT_QUOTES | ENT_HTML5, 'UTF-8')); } goto k1Xwo; k1Xwo: if (preg_match('/<h1[^>]*>(.*?)<\\/h1>/is', $cbr0c, $BDjq4)) { return trim(html_entity_decode(strip_tags($BDjq4[1]), ENT_QUOTES | ENT_HTML5, 'UTF-8')); } goto x9fej; HIkbS: } public static function extract_meta_description(string $cbr0c) : string { goto dnT8t; k95Qc: return ''; goto GY9KW; Ifv3C: $wvvt1 = $sd5DK->getElementsByTagName('meta'); goto qeRYR; QYqGX: if (preg_match('/<meta[^>]+property\\s*=\\s*[\'"]og:description[\'"][^>]+content\\s*=\\s*[\'"]([^\'"]*)[\'"]/i', $cbr0c, $BDjq4)) { return html_entity_decode($BDjq4[1], ENT_QUOTES | ENT_HTML5, 'UTF-8'); } goto k95Qc; dnT8t: libxml_use_internal_errors(true); goto aUuPh; qeRYR: foreach ($wvvt1 as $BDjq4) { goto ZO1gi; ZO1gi: $GcW_D = strtolower((string) $BDjq4->getAttribute('name')); goto HJ6xC; HJ6xC: $qrhPT = strtolower((string) $BDjq4->getAttribute('property')); goto fLwhL; fLwhL: if ($GcW_D === 'description' || $qrhPT === 'og:description') { $aEvo3 = (string) $BDjq4->getAttribute('content'); if ($aEvo3 !== '') { return $aEvo3; } } goto Q91zI; Q91zI: } goto TVEkB; TVEkB: if (preg_match('/<meta[^>]+name\\s*=\\s*[\'"]description[\'"][^>]+content\\s*=\\s*[\'"]([^\'"]*)[\'"]/i', $cbr0c, $BDjq4)) { return html_entity_decode($BDjq4[1], ENT_QUOTES | ENT_HTML5, 'UTF-8'); } goto QYqGX; kUlm4: $sd5DK->loadHTML('<?xml encoding="utf-8" ?>' . $cbr0c); goto Q9GCW; aUuPh: $sd5DK = new DOMDocument(); goto kUlm4; Q9GCW: libxml_clear_errors(); goto Ifv3C; GY9KW: } }
