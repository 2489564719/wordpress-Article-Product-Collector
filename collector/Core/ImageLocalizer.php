<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-22 08:59:56              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_ImageLocalizer { public static function localize_html(string $cbr0c, string $d63TR, SBB_Collector_Logger $l_bxf, int $c8UN4 = 0) : string { goto cZIpI; Ssv0S: $sd5DK = new DOMDocument(); goto YWb6p; X7HSQ: $RXRRG = libxml_get_errors(); goto Wdu8w; GKp37: libxml_clear_errors(); goto Ssv0S; ze1oV: $mLEpW = new DOMXPath($sd5DK); goto zKgW4; vjspx: $l_bxf->info('Image localized summary for HTML', ['done' => $NkhUg, 'total' => $iYoAl]); goto F140E; YlGSE: $iYoAl = $up4DZ ? $up4DZ->length : 0; goto dp1xd; Wdu8w: if (!empty($RXRRG)) { $l_bxf->warn('HTML parsing produced errors.', ['errors' => wp_json_encode($RXRRG)]); } goto FvFlw; YGaTI: libxml_use_internal_errors($St1KG); goto hYZda; YWb6p: $sd5DK->loadHTML('<?xml encoding="utf-8" ?>' . $cbr0c); goto X7HSQ; cZIpI: $St1KG = libxml_use_internal_errors(true); goto GKp37; JGOzW: $l_bxf->info('Image scan', ['found' => $iYoAl]); goto k8KAc; dp1xd: $NkhUg = 0; goto JGOzW; hYZda: return $AtZ0M ?: ''; goto o2EtK; kjw9m: if ($up4DZ && $up4DZ->length) { foreach ($up4DZ as $Gc9hB) { goto AfEJn; CaSWa: if ($ZaQ0s) { $dX3Mt[] = $ZaQ0s; } goto wsJay; AzPNa: $fWXLU = $Gc9hB->getAttribute('src'); goto LBYuJ; lEouX: $ZaQ0s = $Gc9hB->getAttribute('data-original'); goto CaSWa; AfEJn: $dX3Mt = []; goto AzPNa; f7aBT: $yEo9C = ''; goto BD9k5; Wz5EV: $Q16mA = $Gc9hB->getAttribute('data-src'); goto rJk8b; wsJay: $YFNqx = $Gc9hB->getAttribute('srcset'); goto c27tS; c27tS: if ($YFNqx) { goto O3gHH; PFqDa: $y_b8Y = trim(explode(' ', $xlskQ)[0]); goto zoNny; zoNny: if ($y_b8Y) { $dX3Mt[] = $y_b8Y; } goto qAP3L; O3gHH: $xlskQ = trim(explode(',', $YFNqx)[0]); goto PFqDa; qAP3L: } goto f7aBT; BD9k5: foreach ($dX3Mt as $uojSP) { $XQgpF = self::download_and_attach($uojSP, $d63TR, $l_bxf, $c8UN4); if ($XQgpF) { $NHyyK = wp_get_attachment_url($XQgpF); if ($NHyyK) { $yEo9C = $NHyyK; break; } } } goto Ez_V6; LBYuJ: if ($fWXLU) { $dX3Mt[] = $fWXLU; } goto Wz5EV; rJk8b: if ($Q16mA) { $dX3Mt[] = $Q16mA; } goto lEouX; Ez_V6: if ($yEo9C) { goto z8Ukr; z1C04: $Gc9hB->removeAttribute('data-src'); goto q4_fB; UMDS3: $l_bxf->info('Image localized in HTML', ['url' => $yEo9C]); goto eA5JX; swwnr: $Gc9hB->removeAttribute('srcset'); goto HW7_f; HW7_f: $NkhUg++; goto UMDS3; z8Ukr: $Gc9hB->setAttribute('src', $yEo9C); goto z1C04; q4_fB: $Gc9hB->removeAttribute('data-original'); goto swwnr; eA5JX: } else { $l_bxf->warn('Image localize failed in HTML', ['candidates' => $dX3Mt]); } goto OEdGj; OEdGj: } } goto vjspx; F140E: $AtZ0M = $sd5DK->saveHTML(); goto jKHw2; jKHw2: $AtZ0M = preg_replace('#^.*?<body>(.*)</body>.*$#is', '$1', $AtZ0M); goto YGaTI; k8KAc: if (!function_exists('media_handle_sideload')) { goto T44uB; oXmir: require_once ABSPATH . 'wp-admin/includes/media.php'; goto cToaF; cToaF: require_once ABSPATH . 'wp-admin/includes/image.php'; goto zwaql; T44uB: require_once ABSPATH . 'wp-admin/includes/file.php'; goto oXmir; zwaql: } goto kjw9m; FvFlw: libxml_clear_errors(); goto ze1oV; zKgW4: $up4DZ = $mLEpW->query('//img'); goto YlGSE; o2EtK: } public static function localize_urls(array $gpN3Y, string $d63TR, SBB_Collector_Logger $l_bxf, int $c8UN4 = 0) : array { goto WZsMc; WZsMc: $EduGi = []; goto o9H4K; o9H4K: foreach ($gpN3Y as $ShF28) { $XQgpF = self::download_and_attach($ShF28, $d63TR, $l_bxf, $c8UN4); if ($XQgpF) { $EduGi[] = $XQgpF; } } goto cASF3; cASF3: return $EduGi; goto wfjBO; wfjBO: } private static function download_and_attach(string $ShF28, string $d63TR, SBB_Collector_Logger $l_bxf, int $c8UN4 = 0) : int { goto wcs64; goE2c: return self::download($hqKlT, $d63TR, $l_bxf, $c8UN4); goto NEAaL; Bqfzx: if (!$hqKlT) { $l_bxf->warn('Could not convert to absolute URL', ['url' => $ShF28]); return 0; } goto goE2c; wcs64: $hqKlT = self::to_abs($ShF28, $d63TR); goto Bqfzx; NEAaL: } private static function download(string $ShF28, string $qYNxA, SBB_Collector_Logger $l_bxf, int $c8UN4 = 0) : int { goto WZSlS; WZSlS: $ShF28 = trim($ShF28); goto D2Kim; D2Kim: if ($ShF28 !== '') { $dZ9va = wp_parse_url($ShF28); if (is_array($dZ9va) && !empty($dZ9va['scheme']) && !empty($dZ9va['host'])) { goto GYshb; jSXra: $H40Mo = isset($dZ9va['port']) ? ':' . $dZ9va['port'] : ''; goto fPJwY; GYshb: $bDdE7 = $dZ9va['scheme']; goto CK_5Z; uxx7s: $ywL2F = isset($dZ9va['query']) ? '?' . $dZ9va['query'] : ''; goto koUVR; ebhdc: if ($aIMGW !== '') { goto jlBEw; y3Beu: $tQjmq = array_map(static function ($ow_kR) { return preg_match('/%[0-9A-Fa-f]{2}/', $ow_kR) ? $ow_kR : rawurlencode($ow_kR); }, $tQjmq); goto F9rSG; jlBEw: $tQjmq = explode('/', $aIMGW); goto y3Beu; F9rSG: $aIMGW = implode('/', $tQjmq); goto JFaTS; JFaTS: } goto uxx7s; fPJwY: $aIMGW = $dZ9va['path'] ?? ''; goto ebhdc; CK_5Z: $JgIkx = $dZ9va['host']; goto jSXra; koUVR: $wPmCG = isset($dZ9va['fragment']) ? '#' . $dZ9va['fragment'] : ''; goto ibjN8; ibjN8: $ShF28 = "{$bDdE7}://{$JgIkx}{$H40Mo}{$aIMGW}{$ywL2F}{$wPmCG}"; goto cszy5; cszy5: } } goto YCS1A; arK5I: $W0LbZ = 3; goto eLAL0; is2Pu: for ($KJwU8 = 0; $KJwU8 < $W0LbZ; $KJwU8++) { $q2DKB = download_url($ShF28, 90); if (is_wp_error($q2DKB)) { goto rfD0V; W1Bj6: continue; goto PkoUg; rfD0V: $dEGga = $q2DKB->get_error_message(); goto yQyfN; yQyfN: usleep(200000 * ($KJwU8 + 1)); goto W1Bj6; PkoUg: } $h_KQk = wp_check_filetype(basename($ShF28), null); $C8uRi = basename(parse_url($ShF28, PHP_URL_PATH)); if (empty($C8uRi) || strpos($C8uRi, '.') === false) { $VuXNl = empty($h_KQk['ext']) ? 'jpg' : $h_KQk['ext']; $C8uRi = 'image-' . wp_generate_password(8, false) . '.' . $VuXNl; } $z6J9P = ['name' => $C8uRi, 'tmp_name' => $q2DKB]; $anbiR = media_handle_sideload($z6J9P, $c8UN4); if (is_wp_error($anbiR)) { goto Wl1U0; vDzDi: usleep(200000 * ($KJwU8 + 1)); goto KYXI0; l9HOI: $dEGga = $anbiR->get_error_message(); goto vDzDi; KYXI0: continue; goto sWgjM; Wl1U0: @unlink($q2DKB); goto l9HOI; sWgjM: } $RjJtP = wp_get_attachment_url($anbiR); if (empty($RjJtP)) { goto c6clg; bLx3n: usleep(200000 * ($KJwU8 + 1)); goto w8UKR; c6clg: @unlink($q2DKB); goto ZWMNp; YnYK5: $dEGga = 'Failed to get attachment URL after sideload.'; goto bLx3n; ZWMNp: wp_delete_attachment($anbiR, true); goto YnYK5; w8UKR: continue; goto YKzGg; YKzGg: } $l_bxf->info('Image downloaded and attached', ['url' => $ShF28, 'att_id' => $anbiR]); return (int) $anbiR; } goto jupbh; IW0NB: return 0; goto R2w99; eLAL0: $dEGga = ''; goto is2Pu; YCS1A: if (!function_exists('media_handle_sideload')) { goto XUhqq; XUhqq: require_once ABSPATH . 'wp-admin/includes/file.php'; goto YS7JW; pOxTJ: require_once ABSPATH . 'wp-admin/includes/image.php'; goto i7Lv7; YS7JW: require_once ABSPATH . 'wp-admin/includes/media.php'; goto pOxTJ; i7Lv7: } goto arK5I; jupbh: $l_bxf->error('Download failed after retries', ['url' => $ShF28, 'error' => $dEGga]); goto IW0NB; R2w99: } private static function to_abs(string $Bd9Ap, string $HeTeb) : string { goto dYT2F; dYT2F: if (empty($Bd9Ap)) { return ''; } goto LsX0l; TjKpZ: if (!$ZEQ2h || empty($ZEQ2h['scheme']) || empty($ZEQ2h['host'])) { return ''; } goto CAoTA; XsOvT: if (strpos($Bd9Ap, '//') === 0) { $W6XzZ = parse_url($HeTeb, PHP_URL_SCHEME) ?: 'https'; return $W6XzZ . ':' . $Bd9Ap; } goto NBsBz; LbayT: return $Nughu . $RaIe2 . $Bd9Ap; goto PkcKS; LsX0l: if (preg_match('#^https?://#i', $Bd9Ap)) { return $Bd9Ap; } goto XsOvT; NBsBz: $ZEQ2h = wp_parse_url($HeTeb); goto TjKpZ; LgfR4: $RaIe2 = isset($ZEQ2h['path']) ? preg_replace('#/[^/]*$#', '/', $ZEQ2h['path']) : '/'; goto LbayT; CAoTA: $Nughu = $ZEQ2h['scheme'] . '://' . $ZEQ2h['host'] . (!empty($ZEQ2h['port']) ? ':' . $ZEQ2h['port'] : ''); goto DYjGY; DYjGY: if (strpos($Bd9Ap, '/') === 0) { return $Nughu . $Bd9Ap; } goto LgfR4; PkcKS: } }
