<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-22 08:59:56              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_Jobs { public static function init() : void { add_action('sbb_collector_process_staging', [self::class, 'process_staging'], 10, 1); } public static function enqueue_staging_process(int $sOFJn) : void { if (function_exists('as_enqueue_async_action')) { as_enqueue_async_action('sbb_collector_process_staging', [$sOFJn]); } else { wp_schedule_single_event(time() + 5, 'sbb_collector_process_staging', [$sOFJn]); } } public static function process_staging(int $sOFJn) : void { goto l1400; Ppvlu: if ($cbr0c === '') { SBB_Collector_StagingStore::update_data($sOFJn, ['log' => $l_bxf->text(), 'status' => 'failed']); return; } goto JqjPx; triyv: delete_transient($ZMQrE); goto ViZJ2; Ie5bB: SBB_Collector_StagingStore::update_data($sOFJn, $Xky_p); goto C9vzj; VEoST: $ZMQrE = 'sbb_collector_source_fields_' . ($PhYkQ === 'post' ? 'post' : 'product'); goto triyv; l1400: $l_bxf = new SBB_Collector_Logger(); goto d_b75; cCanI: if (empty($ShF28) || empty($GLzg9)) { goto ND55X; AVkdL: return; goto uo3kq; MjHZj: SBB_Collector_StagingStore::update_data($sOFJn, ['log' => $l_bxf->text(), 'status' => 'failed']); goto AVkdL; ND55X: $l_bxf->error('源 URL 或采集规则为空，任务终止。', ['staging_id' => $sOFJn]); goto MjHZj; uo3kq: } goto L7MX7; cTEzZ: if (!is_array($Elm06)) { goto AwpB8; AwpB8: $l_bxf->error('Staging data not found or invalid.', ['staging_id' => $sOFJn]); goto q3dY_; q3dY_: SBB_Collector_StagingStore::update_data($sOFJn, ['log' => $l_bxf->text(), 'status' => 'failed']); goto RH6jA; RH6jA: return; goto Geset; Geset: } goto AWoNc; L7MX7: $cbr0c = SBB_Collector_Crawler::fetch($ShF28, $l_bxf); goto Ppvlu; C9vzj: $PhYkQ = $Elm06['content_type'] ?? 'product'; goto VEoST; pdGHn: $GLzg9 = $Elm06['rules'] ?? []; goto cCanI; Y76yx: $sfeOc = ''; goto eTFVr; hr3lR: $Xky_p = ['log' => $l_bxf->text(), 'preview_html' => $sfeOc, 'extracted_data' => $dOxhW, 'designated_images' => $KSGyZ, 'status' => 'processed']; goto Ie5bB; JqjPx: $dOxhW = []; goto evjLe; d_b75: $Elm06 = get_post_meta($sOFJn, SBB_Collector_StagingStore::META_KEY, true); goto cTEzZ; AWoNc: $ShF28 = $Elm06['source_url'] ?? ''; goto pdGHn; eTFVr: if (is_array($GLzg9) && !empty($GLzg9)) { foreach ($GLzg9 as $p36LP) { goto VkTUP; NPBvF: if (!$F13Sc) { continue; } goto a20u6; pcVUy: if ($V16cl === 'image' || $V16cl === 'images') { goto dss9W; xRvJ2: $MzJ7E = array_map(function ($X2EbN) { return $X2EbN['content']; }, SBB_Collector_Parser::extract($cbr0c, $F13Sc, $V16cl, '', $l_bxf)); goto Wimgn; dss9W: $F13Sc = sanitize_text_field($p36LP['selector'] ?? ''); goto Z1Laz; Wimgn: if (!empty($MzJ7E)) { $EduGi = SBB_Collector_ImageLocalizer::localize_urls($MzJ7E, $ShF28, $l_bxf, $sOFJn); if (!empty($EduGi)) { $KSGyZ[$mdMyK] = ['type' => $V16cl, 'attachment_ids' => $EduGi]; $l_bxf->info('Designated images processed.', ['name' => $mdMyK, 'ids' => $EduGi]); } } goto xAUa7; xAUa7: continue; goto D0QYw; Z1Laz: if (!$F13Sc) { continue; } goto xRvJ2; D0QYw: } goto Op0n0; a20u6: $dcPKX = sanitize_text_field($p36LP['attr'] ?? ''); goto s95ef; fWBT8: $V16cl = sanitize_text_field($p36LP['type'] ?? 'html'); goto y8nq2; y8nq2: if (array_key_exists('value', $p36LP) && empty($p36LP['selector']) && empty($p36LP['builtin'])) { goto qYWCa; qPnTj: continue; goto ylyoo; qYWCa: $pWWEe = (string) $p36LP['value']; goto gK8kx; Z084f: $sfeOc .= '<h3>' . esc_html($mdMyK) . '</h3>'; goto J2S5M; J2S5M: if ($pWWEe !== '') { $sfeOc .= '<p>' . esc_html($pWWEe) . '</p>'; } goto qPnTj; gK8kx: $dOxhW[$mdMyK] = ['type' => 'text', 'content' => $pWWEe]; goto Z084f; ylyoo: } goto pcVUy; pnI0M: $F13Sc = sanitize_text_field($p36LP['selector'] ?? ''); goto NPBvF; BNf6Q: $P63FW = []; goto OG9hk; V56Pr: $dOxhW[$mdMyK] = ['type' => $V16cl, 'content' => implode("\r\n\r\n", $P63FW)]; goto wtp2E; VkTUP: $mdMyK = sanitize_text_field($p36LP['name'] ?? ''); goto hCtTc; OG9hk: foreach ($sY0sO as $I2qZI) { $fMNmv = $I2qZI['content']; if ($I2qZI['kind'] !== 'html') { $sfeOc .= '<p>' . esc_html($fMNmv) . '</p>'; $P63FW[] = $fMNmv; } else { goto lkVt6; lkVt6: $e7VBi = SBB_Collector_ImageLocalizer::localize_html($fMNmv, $ShF28, $l_bxf, $sOFJn); goto f3oNL; WCvlZ: $P63FW[] = $e7VBi; goto vgBad; f3oNL: $sfeOc .= wp_kses_post($e7VBi); goto WCvlZ; vgBad: } } goto V56Pr; s95ef: $sY0sO = SBB_Collector_Parser::extract($cbr0c, $F13Sc, $V16cl, $dcPKX, $l_bxf); goto qCG34; qCG34: $sfeOc .= '<h3>' . esc_html($mdMyK) . '</h3>'; goto BNf6Q; QjuOu: if (!empty($p36LP['builtin'])) { goto DFWXS; aprQN: $sfeOc .= '<h3>' . esc_html($mdMyK) . '</h3><p>' . esc_html($y94Xk) . '</p>'; goto LZ1wK; LZ1wK: continue; goto M75Sp; DFWXS: if ($p36LP['builtin'] === 'title') { $y94Xk = SBB_Collector_Parser::extract_title($cbr0c); } elseif ($p36LP['builtin'] === 'desc') { $y94Xk = SBB_Collector_Parser::extract_meta_description($cbr0c); } goto owEmh; owEmh: $dOxhW[$mdMyK] = ['type' => 'text', 'content' => $y94Xk]; goto aprQN; M75Sp: } goto pnI0M; Op0n0: $y94Xk = ''; goto QjuOu; hCtTc: if (empty($mdMyK)) { continue; } goto fWBT8; wtp2E: } } goto hr3lR; evjLe: $KSGyZ = []; goto Y76yx; ViZJ2: } }
