<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-22 08:59:56              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_Admin_PublishConfigUI { public static function render() : void { goto TNpmy; AR3Pz: echo '<p class="description">' . esc_html($IeE8q) . '</p>'; goto FDbFP; OfZZP: $CbQAc = $W3cNV === 'post' ? '文章分类' : '产品分类'; goto ZOocK; HuLqk: if (!empty($ND_w1)) { $BVNSe[] = $ND_w1; } goto DkuIj; kCXKg: $IeE8q = $W3cNV === 'post' ? '选择一个包含图片URL或HTML的字段作为文章特色图片的来源。' : '选择一个包含图片URL或HTML的字段作为产品图集的唯一来源。'; goto D_uwZ; AttCV: $ejx6p = SBB_Collector_Admin_PublishUI::get_target_fields(); goto Pb40Y; pG4f4: $ZMQrE = 'sbb_collector_source_fields_' . $W3cNV; goto cIEzl; t4NAg: $wKhVF = $eCDwf['direct_publish'] ?? false; goto F82nQ; sulrd: $eCDwf = SBB_Collector_ConfigStore::get_publish_config(); goto AttCV; I7gaJ: $aWCsq = $W3cNV === 'post' ? $xySPy : $fFkN2; goto lhvDw; cIEzl: $gaST3 = get_transient($ZMQrE); goto kaUkR; b0VqU: echo '<input type="hidden" name="action" value="sbb_collector_save_publish_config">'; goto cwHa_; pbkp2: foreach ($Gnj6G as $qFHo9 => $sfsrk) { if ($qFHo9 === $fFkN2 && is_array($sfsrk)) { foreach ($sfsrk as $bEVnB => $zs0W0) { if (!empty($zs0W0)) { $umtTR[$fFkN2 . '[' . $bEVnB . ']'] = $zs0W0; } } } elseif ($qFHo9 === $xySPy && is_array($sfsrk)) { foreach ($sfsrk as $bEVnB => $zs0W0) { if (!empty($zs0W0)) { $umtTR[$xySPy . '[' . $bEVnB . ']'] = $zs0W0; } } } else { $umtTR[rawurldecode($qFHo9)] = $sfsrk; } } goto rBaD6; h3RWX: echo '</tbody></table>'; goto OZkyp; ATBj8: $jdEZc = $eCDwf['language'] ?? ''; goto N2H22; JSi4f: echo '</td></tr></tbody></table>'; goto BPV0F; BPV0F: submit_button('保存发布配置'); goto jkXb1; nKXl7: echo '<tr><th><label for="acf_fields">ACF 字段 meta_key</label></th><td>'; goto iwsud; lhvDw: foreach ($ejx6p as $W1owZ => $VjAtA) { goto SZ3de; UTgwB: echo '<tr><th><label for="mapping_' . esc_attr($W1owZ) . '">' . esc_html($VjAtA) . '</label></th><td>'; goto yw5hs; Tbsp6: foreach ($B8Z5Q as $SkNwo) { echo '<option value="' . esc_attr($SkNwo) . '" ' . selected($y22_H[$W1owZ], $SkNwo, false) . '>' . esc_html($SkNwo) . '</option>'; } goto uYVFb; aoodl: if (!empty($y22_H[$W1owZ]) && !in_array($y22_H[$W1owZ], $B8Z5Q, true)) { echo '<option value="' . esc_attr($y22_H[$W1owZ]) . '" selected>' . esc_html($y22_H[$W1owZ]) . '（已保存）</option>'; } goto Tbsp6; g6ccV: echo '<option value="">— 不映射 —</option>'; goto aoodl; SZ3de: $zaTa4 = strpos($W1owZ, $aWCsq) === 0 ? rawurlencode($W1owZ) : $W1owZ; goto UTgwB; yw5hs: echo '<select name="mapping[' . esc_attr($zaTa4) . ']" id="mapping_' . esc_attr($W1owZ) . '">'; goto g6ccV; uYVFb: echo '</select></td></tr>'; goto MmyAt; MmyAt: } goto UqHLZ; EGtF6: echo '<label><input type="checkbox" name="direct_publish" value="1" ' . checked($wKhVF, true, false) . '/> 勾选后在"采集暂存管理"点击"发布"将自动按规则创建产品（无需手动映射或进入文章编辑）。</label>'; goto ldfIj; ithNb: echo '<form method="post" action="' . esc_url(admin_url('admin-post.php')) . '">'; goto b0VqU; Gumwh: echo '<select name="gallery_source_field" id="gallery_source_field">'; goto wTbhc; KCF_1: echo '<tr><th>直接发布</th><td>'; goto EGtF6; jkXb1: echo '</form></div>'; goto KjOzX; erzc8: echo '<p class="description">每行填写一条记录，格式为：显示名称|CSF字段ID。不包含前缀。例如：产品简介|csf_art_editor_pro_introduction。保存后，在字段映射里将以“显示名称”作为选项标签。</p>'; goto RRllM; TNpmy: if (!current_user_can('manage_options')) { wp_die('权限不足'); } goto D2hKA; rBaD6: $y22_H = wp_parse_args($umtTR, array_fill_keys(array_keys($ejx6p), '')); goto OAjTr; Pb40Y: $Gnj6G = $eCDwf['mapping'] ?? []; goto t4NAg; drg11: $umtTR = []; goto SuTDR; N2H22: $iyWcJ = isset($eCDwf['csf_fields']) ? (string) $eCDwf['csf_fields'] : ''; goto fMpNS; i0CrW: echo '<h2>发布选项</h2><table class="form-table"><tbody>'; goto KCF_1; D2hKA: $W3cNV = SBB_Collector_ConfigStore::get_mode(); goto sulrd; pDv7z: echo '<h2>字段映射</h2><table class="form-table"><tbody>'; goto I7gaJ; WWCVa: $iqRzR = $W3cNV === 'post' ? '特色图片来源' : '图集来源'; goto kCXKg; RRllM: echo '</td></tr>'; goto nKXl7; SuTDR: $fFkN2 = SBB_Collector_ConfigStore::get_csf_prefix_product(); goto Y0fqk; F82nQ: $WFZO8 = $eCDwf['product_cat_id'] ?? 0; goto JtAAr; ldfIj: echo '</td></tr>'; goto DTflj; jCifV: echo '</td></tr>'; goto mUcqV; wTbhc: echo '<option value="">— 不指定 —</option>'; goto eR3Cz; gcGWD: echo '<tr><th><label for="csf_fields">自定义 CSF 字段</label></th><td>'; goto qSSVw; YoNSU: $w0Tw6 = get_terms($FlZUH); goto VO2_E; SKnok: if (isset($_GET['saved']) && (int) $_GET['saved'] === 1) { echo '<div class="updated notice is-dismissible"><p>发布配置已保存。</p></div>'; } goto jMzY2; UqHLZ: echo '</tbody></table>'; goto WWCVa; jpHPd: $xrXRn = $W3cNV === 'post' ? '文章' : '产品'; goto rTiRS; iwsud: echo '<textarea name="acf_fields" id="acf_fields" rows="4" class="large-text" placeholder="my_acf_field\\nproduct_subtitle">' . esc_textarea($kADT8) . '</textarea>'; goto bDRNx; e6lZV: echo '<tr><th><label for="product_cat_id">默认分类</label></th><td>'; goto dKn0U; OZkyp: echo '<h2>高级字段设置</h2><table class="form-table"><tbody>'; goto gcGWD; rTiRS: echo '<p style="margin-top:16px;font-size:16px;font-weight:600;color:#0073aa;">当前为 <strong>' . esc_html($xrXRn) . '</strong> 采集</p>'; goto SKnok; fMpNS: $kADT8 = isset($eCDwf['acf_fields']) ? (string) $eCDwf['acf_fields'] : ''; goto pG4f4; JtAAr: $ND_w1 = $eCDwf['gallery_source_field'] ?? ''; goto ATBj8; eVYAb: echo '</select>'; goto AR3Pz; jMzY2: echo '<p>预设采集字段到产品字段的映射，设置默认分类，并选择是否直接发布。</p>'; goto ithNb; FDbFP: echo '</td></tr></tbody></table>'; goto i0CrW; Y0fqk: $xySPy = SBB_Collector_ConfigStore::get_csf_prefix_post(); goto pbkp2; kaUkR: if ($gaST3 === false) { goto rPapb; RzY90: if ($YHdGg->have_posts()) { foreach ($YHdGg->posts as $h9COL) { $g5S4s = get_post_meta($h9COL, SBB_Collector_StagingStore::META_KEY, true); if (is_array($g5S4s)) { goto Bi2BJ; LETFD: $V243q = array_merge($qWzk7, $YLbhC); goto o3rDt; KeoLv: $qWzk7 = is_array($g5S4s['extracted_data'] ?? null) ? array_keys($g5S4s['extracted_data']) : []; goto jZ06r; Bi2BJ: $PhYkQ = $g5S4s['content_type'] ?? 'product'; goto gtG9U; gtG9U: if ($W3cNV !== $PhYkQ && !($W3cNV === 'product' && empty($g5S4s['content_type']))) { continue; } goto KeoLv; jZ06r: $YLbhC = is_array($g5S4s['designated_images'] ?? null) ? array_keys($g5S4s['designated_images']) : []; goto LETFD; o3rDt: foreach ($V243q as $qFHo9) { $gaST3[$qFHo9] = true; } goto aHUtu; aHUtu: } } wp_reset_postdata(); } goto zANrF; zANrF: $gaST3 = array_keys($gaST3); goto SXb34; rPapb: $gaST3 = []; goto Otdik; Otdik: $YHdGg = new WP_Query(['post_type' => SBB_Collector_StagingStore::CPT, 'posts_per_page' => 10, 'orderby' => 'date', 'order' => 'DESC', 'fields' => 'ids']); goto RzY90; SXb34: set_transient($ZMQrE, $gaST3, 5 * MINUTE_IN_SECONDS); goto YzZhb; YzZhb: } goto ewpSK; D_uwZ: echo '<h2>图片字段处理</h2><table class="form-table"><tbody>'; goto FP_ZT; OAjTr: echo '<div class="wrap"><h1>发布配置</h1>'; goto jpHPd; FP_ZT: echo '<tr><th><label for="gallery_source_field">' . esc_html($iqRzR) . '</label></th><td>'; goto Gumwh; ewpSK: $BVNSe = array_values(array_filter($Gnj6G)); goto HuLqk; ZOocK: echo '<h2>' . esc_html($CbQAc) . '</h2><table class="form-table"><tbody>'; goto e6lZV; DkuIj: $B8Z5Q = array_unique(array_merge($gaST3, $BVNSe)); goto drg11; eR3Cz: foreach ($B8Z5Q as $SkNwo) { echo '<option value="' . esc_attr($SkNwo) . '" ' . selected($ND_w1, $SkNwo, false) . '>' . esc_html($SkNwo) . '</option>'; } goto eVYAb; dKn0U: $jUcDq = $W3cNV === 'post' ? 'category' : 'product_cat'; goto aNAEF; bDRNx: echo '<p class="description">每行填写一个 ACF 字段的 meta_key（字段名称）。发布时会将采集结果写入对应的 post meta，ACF 会自动读取。</p>'; goto jCifV; VO2_E: if (!is_wp_error($w0Tw6) && !empty($w0Tw6)) { goto U_YEn; twcvh: echo '  $lang.on("change", refreshCats);'; goto xqpec; JT3_K: echo '  }'; goto YL9xR; wnXiE: foreach ($w0Tw6 as $Zoi0B) { $j_lFF[$Zoi0B->term_id] = $Zoi0B; } goto bD5x6; f1a2B: echo '  var $lang = $("#pll_language");'; goto EpPjy; YL9xR: echo '  refreshCats();'; goto twcvh; EeM6V: echo '      var visible = !lang || optLang === lang;'; goto Dq2mO; nEhvw: echo '</script>'; goto I9YYN; Dq2mO: echo '      $(this).toggle(visible);'; goto YuCKD; EpPjy: echo '  var $cat  = $("#product_cat_id");'; goto hTtLY; ODojl: echo '      var optLang = $(this).data("lang") || "";'; goto EeM6V; wkBmY: echo 'jQuery(function($){'; goto f1a2B; goaUQ: echo '</select>'; goto M3Fmh; hTtLY: echo '  function refreshCats(){'; goto PNAAw; mVr21: foreach ($w0Tw6 as $Zoi0B) { goto AOyM0; U0rs0: $qpp1Y = $Zoi0B; goto q6c6w; q6c6w: while ($qpp1Y->parent && isset($j_lFF[$qpp1Y->parent]) && $wc7iV < 10) { $wc7iV++; $qpp1Y = $j_lFF[$qpp1Y->parent]; } goto cbuco; qIm4N: if (function_exists('pll_get_term_language')) { $Iq1VQ = (string) pll_get_term_language($Zoi0B->term_id); } goto ar62_; cbuco: $vDpnP = str_repeat('— ', $wc7iV); goto CQ8Ax; k4Qaw: $Iq1VQ = ''; goto qIm4N; CQ8Ax: $VjAtA = $vDpnP . $Zoi0B->name; goto k4Qaw; ar62_: echo '<option value="' . esc_attr($Zoi0B->term_id) . '" data-lang="' . esc_attr($Iq1VQ) . '" ' . selected($WFZO8, $Zoi0B->term_id, false) . '>' . esc_html($VjAtA) . '</option>'; goto jzPKn; AOyM0: $wc7iV = 0; goto U0rs0; jzPKn: } goto goaUQ; ev1yX: echo '<script type="text/javascript">'; goto wkBmY; YuCKD: echo '    });'; goto JT3_K; hzmzU: echo '    $cat.find("option").each(function(){'; goto ODojl; PNAAw: echo '    var lang = $lang.val() || "";'; goto hzmzU; bD5x6: echo '<select name="product_cat_id" id="product_cat_id">'; goto mVr21; xqpec: echo '});'; goto nEhvw; U_YEn: $j_lFF = []; goto wnXiE; M3Fmh: echo '<p class="description">分类列表会根据上方选择的产品语言在前端即时过滤，仅显示该语言的分类</p>'; goto ev1yX; I9YYN: } else { echo '<p>尚未创建任何产品分类，请先创建至少一个产品分类。</p>'; } goto JSi4f; qSSVw: echo '<textarea name="csf_fields" id="csf_fields" rows="4" class="large-text" placeholder="产品简介|csf_art_editor_pro_introduction\\n型号说明|csf_art_editor_MPM">' . esc_textarea($iyWcJ) . '</textarea>'; goto erzc8; mUcqV: echo '</tbody></table>'; goto OfZZP; aNAEF: $FlZUH = ['taxonomy' => $jUcDq, 'hide_empty' => false]; goto YoNSU; cwHa_: wp_nonce_field('sbb_collector_save_publish_config'); goto pDv7z; DTflj: if (function_exists('pll_languages_list')) { goto zYDxw; Dw1J1: echo '<select name="language" id="pll_language">'; goto NJDhA; b1xYE: if (!empty($lXhrX)) { foreach ($lXhrX as $Iq1VQ) { echo '<option value="' . esc_attr($Iq1VQ) . '" ' . selected($jdEZc, $Iq1VQ, false) . '>' . esc_html($Iq1VQ) . '</option>'; } } goto JuU1_; ApVtJ: echo '<tr><th><label for="pll_language">产品语言</label></th><td>'; goto Dw1J1; zYDxw: $lXhrX = pll_languages_list(['fields' => 'slug']); goto ApVtJ; qEggS: echo '</td></tr>'; goto MqnO9; JuU1_: echo '</select>'; goto XcJ0u; NJDhA: echo '<option value="">— 不指定（使用站点默认语言） —</option>'; goto b1xYE; XcJ0u: echo '<p class="description">选择 Polylang 中的语言，自动发布时产品会设置为对应语言。</p>'; goto qEggS; MqnO9: } goto h3RWX; KjOzX: } public static function handle_save() : void { goto ELxEc; LOgAh: $eCDwf = ['mapping' => $y22_H, 'direct_publish' => $wKhVF, 'product_cat_id' => $WFZO8, 'gallery_source_field' => $ND_w1, 'language' => $jdEZc, 'csf_fields' => $iyWcJ, 'acf_fields' => $kADT8]; goto JQbne; n2Iiw: $jdEZc = isset($_POST['language']) ? sanitize_text_field($_POST['language']) : ''; goto hT3t5; hT3t5: $iyWcJ = isset($_POST['csf_fields']) ? wp_kses_post(str_replace(["\r\n", "\r"], "\n", (string) $_POST['csf_fields'])) : ''; goto PHxwd; ml6Cp: check_admin_referer('sbb_collector_save_publish_config'); goto dv7jK; R_ICo: exit; goto H2UWZ; dv7jK: $dihcX = $_POST['mapping'] ?? []; goto Tug_0; PHxwd: $kADT8 = isset($_POST['acf_fields']) ? wp_kses_post(str_replace(["\r\n", "\r"], "\n", (string) $_POST['acf_fields'])) : ''; goto LOgAh; MdPrJ: $WFZO8 = isset($_POST['product_cat_id']) ? intval($_POST['product_cat_id']) : 0; goto CloE4; WXXxm: wp_redirect(admin_url('admin.php?page=sbb-collector-publish-config&saved=1')); goto R_ICo; Tug_0: $y22_H = []; goto lL6zK; ELxEc: if (!current_user_can('manage_options')) { wp_die('权限不足'); } goto ml6Cp; JQbne: SBB_Collector_ConfigStore::save_publish_config($eCDwf); goto WXXxm; CloE4: $ND_w1 = isset($_POST['gallery_source_field']) ? sanitize_text_field($_POST['gallery_source_field']) : ''; goto n2Iiw; lL6zK: foreach ($dihcX as $G_y7Z => $pWWEe) { goto llmsc; dNqg0: $y22_H[$W1owZ] = sanitize_text_field($pWWEe); goto p0gUo; llmsc: if (empty($pWWEe)) { continue; } goto mujPo; mujPo: $W1owZ = sanitize_text_field(rawurldecode($G_y7Z)); goto dNqg0; p0gUo: } goto xQskk; xQskk: $wKhVF = isset($_POST['direct_publish']) && $_POST['direct_publish'] === '1'; goto MdPrJ; H2UWZ: } }
