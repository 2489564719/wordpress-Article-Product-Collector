<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.17  |
    |              on 2025-11-22 08:59:56              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 if (!defined('ABSPATH')) { exit; } class SBB_Collector_Admin_BatchUI { public static function render() : void { goto VVzWE; VVzWE: if (!current_user_can('manage_options')) { wp_die('权限不足'); } goto t12TQ; VZ2Yq: wp_nonce_field('sbb_collector_batch_start'); goto thWJq; YCcVh: echo '<form method="post" action="' . esc_url(admin_url('admin-post.php')) . '">'; goto VZ2Yq; UipRP: echo '<table class="form-table"><tbody>'; goto HfLIz; Zp6I3: echo '<pre style="background:#fff;border:1px solid #ccd0d4;padding:12px;max-height:300px;overflow:auto;">' . esc_html(wp_json_encode($GLzg9, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES)) . '</pre>'; goto XMVCq; XMVCq: echo '</div>'; goto G2_aR; BgqIK: $xrXRn = $W3cNV === 'post' ? '文章' : '产品'; goto rIqWQ; V5yEa: submit_button('开始批量采集'); goto EHBPv; HfLIz: echo '<tr><th scope="row"><label for="urls">要采集的URL</label></th>'; goto qegmS; tmoOV: echo '<h3>当前使用的全局采集规则</h3>'; goto Zp6I3; qegmS: echo '<td><textarea name="urls" id="urls" rows="10" class="large-text" placeholder="https://example.com/page1;\\r\\nhttps://example.com/page2"></textarea></td></tr>'; goto uguZZ; EHBPv: echo '</form>'; goto W9xE7; scNWW: echo '<p>在此处粘贴多个URL（每个URL占一行或用分号;分隔），系统将使用"采集配置"页保存的全局规则为每个URL创建暂存任务。</p>'; goto YCcVh; Unlj3: $W3cNV = SBB_Collector_ConfigStore::get_mode(); goto BgqIK; t12TQ: echo '<div class="wrap"><h1>批量采集</h1>'; goto Unlj3; W9xE7: $GLzg9 = SBB_Collector_ConfigStore::all(); goto tmoOV; y51IC: if (isset($_GET['submitted']) || isset($_GET['skipped'])) { goto wgzQA; drb7s: if ($tA3hD > 0) { echo ' ' . esc_html($tA3hD) . ' 个任务因重复而被跳过。'; } goto wPR9P; aznzJ: echo '<div class="updated"><p>'; goto ZsLeZ; wPR9P: echo '</p></div>'; goto EqYCN; j1O4Y: $tA3hD = (int) ($_GET['skipped'] ?? 0); goto aznzJ; ZsLeZ: if ($iZ8Gx > 0) { echo esc_html($iZ8Gx) . ' 个新任务已加入后台处理队列。'; } goto drb7s; wgzQA: $iZ8Gx = (int) ($_GET['submitted'] ?? 0); goto j1O4Y; EqYCN: } goto scNWW; uguZZ: echo '</tbody></table>'; goto V5yEa; rIqWQ: echo '<p style="margin-top:16px;font-size:16px;font-weight:600;color:#0073aa;">当前为 <strong>' . esc_html($xrXRn) . '</strong> 采集</p>'; goto y51IC; thWJq: echo '<input type="hidden" name="action" value="sbb_collector_batch_start">'; goto UipRP; G2_aR: } public static function handle_start() : void { goto DPsaG; nXwJ4: $yOu79 = add_query_arg(['submitted' => $tqQFd, 'skipped' => $akl50], admin_url('admin.php?page=sbb-collector-batch')); goto lPcDO; Ha04H: $nmNgG = wp_unslash($_POST['urls'] ?? ''); goto A2KMJ; aBbkF: $GLzg9 = SBB_Collector_ConfigStore::all(); goto euV6V; ynOHq: check_admin_referer('sbb_collector_batch_start'); goto aBbkF; j3oLb: foreach ($gpN3Y as $ShF28) { goto gCvZ2; gCvZ2: if (!filter_var($ShF28, FILTER_VALIDATE_URL)) { continue; } goto mK1ol; m6JiS: $h9COL = SBB_Collector_StagingStore::create('批量采集 - ' . (wp_parse_url($ShF28, PHP_URL_HOST) ?: $ShF28), ['source_url' => $ShF28, 'rules' => $US2sW, 'content_type' => $W3cNV]); goto XV5Vz; mK1ol: if (SBB_Collector_StagingStore::is_source_url_exists($ShF28)) { $akl50++; continue; } goto m6JiS; XV5Vz: if ($h9COL) { SBB_Collector_Jobs::enqueue_staging_process($h9COL); $tqQFd++; } goto R07JF; R07JF: } goto nXwJ4; Q3p3Z: $tqQFd = 0; goto AHRAH; g_K1B: exit; goto DbB_6; RtA8S: if (empty($US2sW)) { wp_die('规范化后的采集规则为空，请检查"采集配置"页的 JSON 格式是否正确。 <a href="' . admin_url('admin.php?page=sbb-collector-config') . '">前往设置</a>'); } goto Ha04H; A2KMJ: $gpN3Y = array_unique(array_filter(array_map('trim', preg_split('/[\\r\\n;]+/', $nmNgG)))); goto Q3p3Z; lPcDO: wp_redirect($yOu79); goto g_K1B; RoFC4: $W3cNV = SBB_Collector_ConfigStore::get_mode(); goto RtA8S; AHRAH: $akl50 = 0; goto j3oLb; PhQ1t: $US2sW = SBB_Collector_RuleManager::normalize($GLzg9); goto RoFC4; euV6V: if (empty($GLzg9)) { wp_die('采集规则为空，请先在"采集配置"页设置。 <a href="' . admin_url('admin.php?page=sbb-collector-config') . '">前往设置</a>'); } goto PhQ1t; DPsaG: if (!current_user_can('manage_options')) { wp_die('权限不足'); } goto ynOHq; DbB_6: } }
